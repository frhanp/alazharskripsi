<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Peta Interaktif</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; }
        #map { height: 400px; width: 60%; cursor: pointer; }
        .controls { width: 35%; }
        input { width: 100%; padding: 8px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; background-color: #f4f4f4; }
        button { padding: 10px 15px; font-size: 16px; cursor: pointer; width: 100%; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="controls">
        <h3>Input Lokasi</h3>
        <p>Klik di peta, geser penanda, atau gunakan lokasi Anda.</p>
        
        <button id="get-location-btn">Gunakan Lokasi Saya</button>
        <p id="status" style="font-size: 12px; color: grey;"></p>

        <div>
            <label>Latitude:</label>
            <input type="text" id="latitude" name="latitude" readonly>
        </div>
        <div>
            <label>Longitude:</label>
            <input type="text" id="longitude" name="longitude" readonly>
        </div>
    </div>

    <script>
        const latInput = document.getElementById('latitude');
        const lonInput = document.getElementById('longitude');
        const getLocationBtn = document.getElementById('get-location-btn');
        const statusEl = document.getElementById('status');
        
        const defaultCoords = [0.542, 123.059];

        const map = L.map('map').setView(defaultCoords, 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const marker = L.marker(defaultCoords, { draggable: true }).addTo(map);

        function updateMarkerAndInputs(latlng) {
            marker.setLatLng(latlng);
            latInput.value = latlng.lat.toFixed(7);
            lonInput.value = latlng.lng.toFixed(7);
        }

        updateInputs(marker.getLatLng());

        marker.on('dragend', function(e) {
            updateInputs(e.target.getLatLng());
            statusEl.textContent = 'Posisi disesuaikan secara manual.';
        });

        // =======================================================
        // PATOKAN: tes-peta-interaktif.html
        // AWAL PERUBAHAN: Tambahkan event listener untuk klik di peta
        // =======================================================
        map.on('click', function(e) {
            updateMarkerAndInputs(e.latlng);
            statusEl.textContent = 'Posisi diubah via klik peta.';
        });
        // =======================================================
        // AKHIR PERUBAHAN
        // =======================================================

        getLocationBtn.addEventListener('click', function() {
            if (!navigator.geolocation) {
                statusEl.textContent = 'Geolocation tidak didukung.';
                return;
            }
            statusEl.textContent = 'Meminta lokasi...';
            navigator.geolocation.getCurrentPosition(function(position) {
                const userCoords = { lat: position.coords.latitude, lng: position.coords.longitude };
                map.setView(userCoords, 16);
                updateMarkerAndInputs(userCoords);
                statusEl.textContent = 'Lokasi ditemukan! Anda bisa klik/geser penanda jika kurang akurat.';
            }, function() {
                statusEl.textContent = 'Gagal mendapatkan lokasi.';
            });
        });

        // Fungsi terpisah untuk update input, agar tidak duplikat
        function updateInputs(latlng) {
            latInput.value = latlng.lat.toFixed(7);
            lonInput.value = latlng.lng.toFixed(7);
        }
    </script>
</body>
</html>